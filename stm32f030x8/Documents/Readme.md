# 探头说明 V0.1
---------
## 1、参数
### 1.1芯片

#### 型号：STM32F030R8Tx
引脚 | 功能
---|---
PA1 | RS485EN
PA4 | 温度AD检测
PA5 | 探头浓度检测
PA10|Rx
PA9|Tx


##### 通讯参数

波特率: 9600bit/s \
数据位: 8 \
校验位：无校验 \
停止位：1

##### 通讯协议

Modbus/RTU \
探头默认地址 **0x02** 
_____________
#### 内部寄存器说明

Addr | Coil Status | Input Status | Holding Register | Input Register
---  |---          |---           |---               |     ---
0    |             |    温度       |              |             
1    |              |              |              |             
2    |              |  探头浓度    |  探头浓度    | 
3    |              |              |              | 
4    |              |              |  分子量      | 
.    |              |              |              | 
.    |              |              |              |
.    |              |              |              | 
19   |              |              |              | 

#### 例：
**主机请求：**

设备地址 | 功能码|起始地址高位|起始地址地位|数据字长高位|数据字长低位|CRC低位|CRC高位
|---|---|---|---|---|---|---|---|---|---|
|0x02|0x03|0x00|0x00|0x00|0x04|0x44|0x3A

**探头应答：**

设备地址|功能码|数据字节数|数据1高位|数据1低位|数据2高位|数据2低位|数据3高位|数据4高位|数据4低位|CRC低位|CRC高位
|---|---|---|---|---|---|---|---|---|---|---|---|
|0x02|0x03|0x08|0x00|0x02|0x00|0x27|0x00|0x00|0x00|0x01|0x4E|0x96|

数据4：探头浓度，实际浓度=寄存器数据*0.01

_**浓度计算公式**_
```    
molecular_weight = MB_ReadRegister(MBREGISTERHOLIDING,0) + 58;
r0=((0-0.015)*temperature+1.3)*24000;
rs=1000*(5/((sum2/25)*3.3/4096))-1000;
rsr0=rs/r0;
gasPPM=pow(10,(log10(rsr0)+0.154)/(0-0.32));
gasMgM3 = (uint16_t)(gasPPM * (molecular_weight / 22.4) * 100);  // 58/22.4
```
molecular_weight : 分子量 \
_分子量越小，浓度输出值越小（比例缩减）_

_注：_ 以上计算代码为**TGS2600**特性曲线得出，```molecular_weight = MB_ReadRegister(MBREGISTERHOLIDING,0) + 58;```中的**58**为 _异丁烷（C4H10）_ 的分子量大小。`r0=((0-0.015)*temperature+1.3)*24000;`中**2400**为默认在温度26摄氏度，湿度65%条件下R0的阻值。`rs=1000*(5/((sum2/25)*3.3/4096))-1000;`中**sum2**为ADC所猜到的二进制量，这里计算出Rs阻值

![](http://ww1.sinaimg.cn/large/006lh1f0gy1fvm2iwm8i7j30sm0juwij.jpg)

### 功能补充
























